<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resident Assessment Form – 9-Step</title>
  <style>
    /* ---------- Basic Page & Body Styles ---------- */
    body {
      margin: 0 auto;
      max-width: 800px;
      padding: 10px;
      font-family: Arial, sans-serif;
      color: #333;
      font-size: 18px;
      background-color: #f7f9f4;
      background-image: url("https://i.ibb.co/tpQ4Yh49/Greensleeves-Care-Brand-Ribbon-scaled.webp");
      background-repeat: no-repeat;
      background-position: bottom left;
      background-size: 300px auto;
    }

    /* ---------- Header & Logo ---------- */
    .header-brand {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      border-bottom: 2px solid #8b9a73;
      padding-bottom: 1rem;
    }
    .header-brand img {
      width: 90px;
      height: auto;
      margin-right: 1rem;
    }
    .header-brand h1 {
      font-size: 1.8rem;
      color: #546038;
      margin: 0;
    }

    /* ---------- Multi-Step Form Steps ---------- */
    .form-step {
      display: none; /* hidden by default */
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin: 1rem 0;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .form-step.active {
      display: block; /* show the active step */
    }
    .form-step h2 {
      font-size: 1.4rem;
      margin-top: 0;
    }

    /* ---------- Labels & Inputs ---------- */
    label {
      display: block;
      margin: 1rem 0 0.25rem;
      font-weight: bold;
      font-size: 1rem;
    }
    small {
      display: block;
      font-weight: normal;
      color: #555;
      margin-top: 0.1rem;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    textarea {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 0.8rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    input[type="checkbox"] {
      margin-right: 0.5rem;
      transform: scale(1.2);
    }
    /* read-only fields so users can't overwrite them */
    #age,
    #bmiScore {
      background-color: #f2f2f2;
    }

    /* ---------- Buttons & Summary Textarea ---------- */
    .btn-container {
      text-align: center;
      margin: 1rem 0;
    }
    .btn-nav {
      cursor: pointer;
      padding: 0.7rem 1.4rem;
      margin: 0.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      background-color: #8b9a73;
      color: #fff;
    }
    .btn-nav:hover {
      background-color: #6f7f58;
    }
    #summary {
      width: 100%;
      min-height: 150px;
      margin-top: 1rem;
      font-size: 1rem;
    }

    /* ---------- Responsive for Mobile (<600px) ---------- */
    @media (max-width: 600px) {
      body {
        padding: 8px;
        font-size: 16px;
      }
      .header-brand {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-brand img {
        margin-bottom: 1rem;
      }
      .header-brand h1 {
        font-size: 1.6rem;
      }
      .form-step h2 {
        font-size: 1.3rem;
      }
      button {
        width: 100%;
        margin-top: 0.5rem;
      }
    }
  </style>
</head>
<body>

  <div class="header-brand">
    <img 
      src="https://i.ibb.co/HL44C8Tw/greensleeves-thumbnail-logo-png-120x120-q50-ALIAS-brand-icon-crop-progressive-subsampling-2-upscale.jpg" 
      alt="Greensleeves Care Logo"
    />
    <h1>Resident Assessment Form</h1>
  </div>

  <form id="assessmentForm">

    <!-- STEP 1 -->
    <div class="form-step active" id="step-1">
      <h2>Step 1: General Information</h2>
      <label>Title</label>
      <input type="text" id="title" name="title" placeholder="Mr/Mrs/Ms/Dr">

      <label>First Name</label>
      <input type="text" id="firstName" name="firstName">

      <label>Last Name</label>
      <input type="text" id="lastName" name="lastName">

      <label>Preferred Name</label>
      <input type="text" id="preferredName" name="preferredName">

      <label>Sex at Birth</label>
      <input type="text" id="sexAtBirth" name="sexAtBirth">

      <label>Gender Identity</label>
      <input type="text" id="genderIdentity" name="genderIdentity" placeholder="Man/Woman/etc.">

      <label>Date of Birth</label>
      <input type="date" id="dob" name="dob">

      <label>Age (Auto-calc)</label>
      <input type="text" id="age" name="age" readonly>

      <label>Resident’s Phone Number</label>
      <input type="text" id="residentPhone" name="residentPhone">

      <label>Resident’s Email</label>
      <input type="text" id="residentEmail" name="residentEmail">

      <label>Quick Notes</label>
      <textarea id="quickNotes" name="quickNotes" rows="3"></textarea>

      <label>NHS/CHI Number</label>
      <input type="text" id="nhsNumber" name="nhsNumber">

      <label>Integration ID</label>
      <small>(Generated or manually entered)</small>
      <input type="text" id="integrationId" name="integrationId">

      <label>
        <input type="checkbox" id="dnacpr" name="dnacpr"> DNACPR in Place?
      </label>
      <label>
        <input type="checkbox" id="dols" name="dols"> DoLS in Place?
      </label>
      <label>
        <input type="checkbox" id="covid19" name="covid19"> Treating as COVID-19?
      </label>

      <div class="btn-container">
        <button type="button" class="btn-nav" id="nextBtn1">Next</button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="form-step" id="step-2">
      <h2>Step 2: Circle of Care</h2>
      <label>Next of Kin Full Name</label>
      <input type="text" id="nokFullName" name="nokFullName">

      <label>Relationship</label>
      <input type="text" id="nokRelationship" name="nokRelationship" placeholder="Daughter, Son, etc.">

      <label>Phone Number</label>
      <input type="text" id="nokPhone" name="nokPhone">

      <label><input type="checkbox" id="poaHealth" name="poaHealth"> Power of Attorney for Health?</label>
      <label><input type="checkbox" id="poaFinance" name="poaFinance"> Power of Attorney for Finance?</label>

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn2">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn2">Next</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="form-step" id="step-3">
      <h2>Step 3: Onboarding &amp; Needs Assessment</h2>
      <label>Date of Admission</label>
      <input type="date" id="dateAdmission" name="dateAdmission">

      <label>Admitted From</label>
      <input type="text" id="admittedFrom" name="admittedFrom" placeholder="Hospital, Home, Another Facility">

      <label>Funding Source</label>
      <input type="text" id="fundingSource" name="fundingSource" placeholder="NHS, Private, Local Authority">

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn3">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn3">Next</button>
      </div>
    </div>

    <!-- STEP 4 -->
    <div class="form-step" id="step-4">
      <h2>Step 4: Clinical Information</h2>
      <label>Allergies &amp; Intolerances</label>
      <textarea id="allergies" name="allergies" rows="3"></textarea>

      <label>Dietary Preferences &amp; Nutrition Needs</label>
      <textarea id="dietaryPreferences" name="dietaryPreferences" rows="3"></textarea>

      <label>Emergency Information &amp; Admission Decision</label>
      <textarea id="emergencyInfo" name="emergencyInfo" rows="3"></textarea>

      <label>Clinical History &amp; Medical Conditions</label>
      <textarea id="clinicalHistory" name="clinicalHistory" rows="3"></textarea>

      <label>Medication List</label>
      <textarea id="medicationList" name="medicationList" rows="3"></textarea>

      <h2>MUST (Malnutrition Universal Screening Tool)</h2>
      <label>Current Weight (kg)</label>
      <input type="number" id="currentWeight" name="currentWeight" step="0.1">

      <label>Current Height (m)</label>
      <input type="number" id="currentHeight" name="currentHeight" step="0.01">

      <label>BMI Score (Auto-calc)</label>
      <input type="text" id="bmiScore" name="bmiScore" readonly>

      <label>Weight Loss in Past 3-6 Months (%)</label>
      <input type="number" id="weightLoss" name="weightLoss" step="0.1">

      <label>Overall MUST Score</label>
      <input type="text" id="mustScore" name="mustScore" placeholder="Low/Med/High or numeric">

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn4">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn4">Next</button>
      </div>
    </div>

    <!-- STEP 5: MANDATORY CARE PLAN SECTIONS WITH ORIGINAL HINTS -->
    <div class="form-step" id="step-5">
      <h2>Step 5: Mandatory Care Plan Sections</h2>

      <label>Advanced Planning / End of Life (EOL)</label>
      <small>
        DNACPR or ReSPECT forms? Wishes for final days (music, visitors)?  
        Funeral arrangements? Any POA or LPA? Cultural/religious preferences?
      </small>
      <textarea id="advancedPlanning" name="advancedPlanning" rows="3"></textarea>

      <label>Cognition</label>
      <small>
        Describe the resident’s cognitive abilities, any memory issues, dementia diagnosis, and support strategies in place.
      </small>
      <textarea id="cognition" name="cognition" rows="3"></textarea>

      <label>Communication</label>
      <small>
        Explain how the resident communicates, including any hearing or speech impairments, use of communication aids, and preferred methods.
      </small>
      <textarea id="communication" name="communication" rows="3"></textarea>

      <label>Continence Care</label>
      <small>
        Specify the type and size of continence products used, frequency of changes, level of assistance required, toileting routines.
      </small>
      <textarea id="continenceCare" name="continenceCare" rows="3"></textarea>

      <label>Emotional Well-being &amp; Mental Health</label>
      <small>
        Include details of emotional and psychological well-being, any mental health conditions, coping mechanisms, and support in place.
      </small>
      <textarea id="emotionalWellbeing" name="emotionalWellbeing" rows="3"></textarea>

      <label>Expressing Sexuality</label>
      <small>
        Describe how the resident presents themselves, including preferences for clothing, makeup, jewelry, gender identity, and social interactions.
      </small>
      <textarea id="sexuality" name="sexuality" rows="3"></textarea>

      <label>Life Enrichment &amp; Social Activities</label>
      <small>
        Detail the resident’s hobbies, interests, social preferences, and participation in activities within or outside the care home.
      </small>
      <textarea id="lifeEnrichment" name="lifeEnrichment" rows="3"></textarea>

      <label>Medication Management</label>
      <small>
        List all medications the resident takes, their purpose, any known side effects, dietary restrictions, and instructions. Signpost to Camascope for details.
      </small>
      <textarea id="medicationManagement" name="medicationManagement" rows="3"></textarea>

      <label>Mobility &amp; Dexterity</label>
      <small>
        Include whether the resident is left-handed, their ability to use buttons/zips, specialist equipment, history of falls, gait, any infections impacting mobility.
      </small>
      <textarea id="mobilityDexterity" name="mobilityDexterity" rows="3"></textarea>

      <label>Nutrition &amp; Hydration</label>
      <small>
        Describe dietary needs, food preferences, allergies, risk of choking, use of adaptive cutlery, hydration support.
      </small>
      <textarea id="nutritionHydration" name="nutritionHydration" rows="3"></textarea>

      <label>Oral Health Care</label>
      <small>
        Specify if the resident has their own teeth, dentures, cleaning routine, type of toothbrush, mouthwash, and visits to dentist/hygienist.
      </small>
      <textarea id="oralHealth" name="oralHealth" rows="3"></textarea>

      <label>Personal Care &amp; Hygiene</label>
      <small>
        Describe assistance needed for washing, showering, bathing, shaving, hair care, use of products, and dressing. Include hand, foot, and nail care.
      </small>
      <textarea id="personalCare" name="personalCare" rows="3"></textarea>

      <label>Physical Health &amp; Well-being</label>
      <small>
        Include diagnoses, ongoing treatments, support from healthcare professionals, and any pain management strategies.
      </small>
      <textarea id="physicalHealth" name="physicalHealth" rows="3"></textarea>

      <label>Skin Integrity &amp; Pressure Care</label>
      <small>
        Describe skin conditions, risk of pressure sores, use of emollients or prescribed creams, involvement of DN or TVN.
      </small>
      <textarea id="skinIntegrity" name="skinIntegrity" rows="3"></textarea>

      <label>Sleeping &amp; Night Care</label>
      <small>
        Detail night-time routine, positioning, preference for lights on/off, use of call bells, comfort needs, nighttime checks required.
      </small>
      <textarea id="sleepingNightCare" name="sleepingNightCare" rows="3"></textarea>

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn5">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn5">Next</button>
      </div>
    </div>

    <!-- STEP 6: SPECIALIST CARE PLANS WITH SEPARATE ROWS + HINTS -->
    <div class="form-step" id="step-6">
      <h2>Step 6: Specialist Care Plans (If Applicable)</h2>

      <label>Anti-Coagulant Management</label>
      <small>Warfarin, INR checks, bridging therapy, bleeding risk, instructions</small>
      <textarea id="antiCoagulant" name="antiCoagulant" rows="3"></textarea>

      <label>Breathing (COPD/Asthma)</label>
      <small>Inhalers, rescue meds, triggers, oxygen usage, etc.</small>
      <textarea id="breathing" name="breathing" rows="3"></textarea>

      <label>Cancer Care</label>
      <small>Chemotherapy, radiotherapy, pain mgmt, psychological support, etc.</small>
      <textarea id="cancerCare" name="cancerCare" rows="3"></textarea>

      <label>Choking Risk &amp; SALT Assessment</label>
      <small>Swallow assessment, pureed diet, staff supervision, SALT recommendations</small>
      <textarea id="chokingRisk" name="chokingRisk" rows="3"></textarea>

      <label>Diabetes Care &amp; Foot Health</label>
      <small>Insulin/oral meds, blood sugar checks, foot checks, diet guidance</small>
      <textarea id="diabetesCare" name="diabetesCare" rows="3"></textarea>

      <label>Epilepsy Management</label>
      <small>Seizure triggers, rescue meds, frequency, post-seizure protocol</small>
      <textarea id="epilepsy" name="epilepsy" rows="3"></textarea>

      <label>Heart Disease &amp; Stroke Recovery</label>
      <small>Angina, heart failure, stroke rehab, physiotherapy, BP checks</small>
      <textarea id="heartDisease" name="heartDisease" rows="3"></textarea>

      <label>Managing Behaviours that Challenge</label>
      <small>Known triggers, de-escalation, ABC charts, PRN usage if relevant</small>
      <textarea id="challengingBehaviours" name="challengingBehaviours" rows="3"></textarea>

      <label>Money Management Support</label>
      <small>Access to finances, who handles money, any spending restrictions</small>
      <textarea id="moneyManagement" name="moneyManagement" rows="3"></textarea>

      <label>Pain Management Plan</label>
      <small>Analgesics, side effects, pain scale, non-pharm approaches, etc.</small>
      <textarea id="painManagement" name="painManagement" rows="3"></textarea>

      <label>Parkinson’s Care</label>
      <small>Time-sensitive meds, tremor mgmt, swallowing issues, mobility concerns</small>
      <textarea id="parkinsons" name="parkinsons" rows="3"></textarea>

      <label>Smoking, Vaping, Alcohol &amp; Drug Use</label>
      <small>Frequency, harm reduction, safe storage, nicotine replacements, etc.</small>
      <textarea id="smokingAlcohol" name="smokingAlcohol" rows="3"></textarea>

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn6">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn6">Next</button>
      </div>
    </div>

    <!-- STEP 7 -->
    <div class="form-step" id="step-7">
      <h2>Step 7: Foot Care Assessment</h2>
      <label>Existing Foot Conditions (Bunions, Ulcers, Corns)</label>
      <textarea id="existingFootConditions" name="existingFootConditions" rows="3"></textarea>

      <label>Toenail Cutting Needs</label>
      <small>Chiropodist visits? Staff assist with moisturizing? etc.</small>
      <textarea id="toenailCutting" name="toenailCutting" rows="3"></textarea>

      <label>
        <input type="checkbox" id="diabetesFoot" name="diabetesFoot"> Diabetes-related Foot Concerns?
      </label>
      <label>
        <input type="checkbox" id="orthopedicFootwear" name="orthopedicFootwear"> Orthopedic Footwear Required?
      </label>

      <label>Podiatry Visits (Frequency &amp; Details)</label>
      <textarea id="podiatryVisits" name="podiatryVisits" rows="3"></textarea>

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn7">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn7">Next</button>
      </div>
    </div>

    <!-- STEP 8 -->
    <div class="form-step" id="step-8">
      <h2>Step 8: Staff Sign-Off</h2>
      <label>Assessment Completed By</label>
      <input type="text" id="completedBy" name="completedBy">

      <label>Date of Completion</label>
      <input type="date" id="dateCompletion" name="dateCompletion">

      <label>Home Manager Approval</label>
      <input type="text" id="homeManagerApproval" name="homeManagerApproval">

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn8">Previous</button>
        <button type="button" class="btn-nav" id="nextBtn8">Next</button>
      </div>
    </div>

    <!-- STEP 9 -->
    <div class="form-step" id="step-9">
      <h2>Step 9: Preview &amp; PDF</h2>
      <small>Click “Generate Summary” to see your inputs, or “Download PDF” to save a copy.</small>

      <div class="btn-container">
        <button type="button" class="btn-nav" id="prevBtn9">Previous</button>
        <button type="button" class="btn-nav" id="generateSummaryBtn">Generate Summary</button>
        <button type="button" class="btn-nav" id="downloadPdfBtn">Download PDF</button>
      </div>

      <label for="summary">Pre-Assessment Summary</label>
      <textarea id="summary" readonly></textarea>
    </div>
  </form>

  <!-- ========== jsPDF ========== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    /* ===================== STEP NAVIGATION LOGIC ===================== */
    const steps = document.querySelectorAll('.form-step');
    let currentStep = 0;

    function showStep(index) {
      steps.forEach((step, i) => {
        step.classList.remove('active');
        if (i === index) {
          step.classList.add('active');
        }
      });
      currentStep = index;
    }

    // Show first step on load
    showStep(0);

    // Next/Prev button references
    const nextBtn1 = document.getElementById('nextBtn1');
    const nextBtn2 = document.getElementById('nextBtn2'); const prevBtn2 = document.getElementById('prevBtn2');
    const nextBtn3 = document.getElementById('nextBtn3'); const prevBtn3 = document.getElementById('prevBtn3');
    const nextBtn4 = document.getElementById('nextBtn4'); const prevBtn4 = document.getElementById('prevBtn4');
    const nextBtn5 = document.getElementById('nextBtn5'); const prevBtn5 = document.getElementById('prevBtn5');
    const nextBtn6 = document.getElementById('nextBtn6'); const prevBtn6 = document.getElementById('prevBtn6');
    const nextBtn7 = document.getElementById('nextBtn7'); const prevBtn7 = document.getElementById('prevBtn7');
    const nextBtn8 = document.getElementById('nextBtn8'); const prevBtn8 = document.getElementById('prevBtn8');
    const prevBtn9 = document.getElementById('prevBtn9');

    // Step 1 -> 2
    if(nextBtn1) nextBtn1.addEventListener('click', () => showStep(1));
    // Step 2 -> 1 or 3
    if(nextBtn2) nextBtn2.addEventListener('click', () => showStep(2));
    if(prevBtn2) prevBtn2.addEventListener('click', () => showStep(0));
    // Step 3 -> 2 or 4
    if(nextBtn3) nextBtn3.addEventListener('click', () => showStep(3));
    if(prevBtn3) prevBtn3.addEventListener('click', () => showStep(1));
    // Step 4 -> 3 or 5
    if(nextBtn4) nextBtn4.addEventListener('click', () => showStep(4));
    if(prevBtn4) prevBtn4.addEventListener('click', () => showStep(2));
    // Step 5 -> 4 or 6
    if(nextBtn5) nextBtn5.addEventListener('click', () => showStep(5));
    if(prevBtn5) prevBtn5.addEventListener('click', () => showStep(3));
    // Step 6 -> 5 or 7
    if(nextBtn6) nextBtn6.addEventListener('click', () => showStep(6));
    if(prevBtn6) prevBtn6.addEventListener('click', () => showStep(4));
    // Step 7 -> 6 or 8
    if(nextBtn7) nextBtn7.addEventListener('click', () => showStep(7));
    if(prevBtn7) prevBtn7.addEventListener('click', () => showStep(5));
    // Step 8 -> 7 or 9
    if(nextBtn8) nextBtn8.addEventListener('click', () => showStep(8));
    if(prevBtn8) prevBtn8.addEventListener('click', () => showStep(6));
    // Step 9 -> 8
    if(prevBtn9) prevBtn9.addEventListener('click', () => showStep(7));

    /* ===================== AUTO-CALCULATE AGE & BMI ===================== */
    const dobField = document.getElementById('dob');
    const ageField = document.getElementById('age');
    const weightField = document.getElementById('currentWeight');
    const heightField = document.getElementById('currentHeight');
    const bmiField = document.getElementById('bmiScore');

    // Age from DOB
    dobField.addEventListener('change', () => {
      const dobValue = dobField.value;
      if(!dobValue) {
        ageField.value = '';
        return;
      }
      const dobDate = new Date(dobValue);
      if(isNaN(dobDate.getTime())) {
        ageField.value = '';
        return;
      }
      const diffMs = Date.now() - dobDate.getTime();
      const ageYears = Math.floor(diffMs / (365.25 * 24 * 60 * 60 * 1000));
      ageField.value = (ageYears >= 0) ? `${ageYears} years` : '';
    });

    // BMI from Weight/Height
    function recalcBMI() {
      const w = parseFloat(weightField.value);
      const h = parseFloat(heightField.value);
      if(w > 0 && h > 0) {
        const bmi = w / (h*h);
        bmiField.value = bmi.toFixed(1);
      } else {
        bmiField.value = '';
      }
    }
    weightField.addEventListener('input', recalcBMI);
    heightField.addEventListener('input', recalcBMI);

    /* ===================== SUMMARY & PDF ===================== */
    const generateSummaryBtn = document.getElementById('generateSummaryBtn');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const summaryArea = document.getElementById('summary');
    const { jsPDF } = window.jspdf;

    // Gather form data
    function getFormData() {
      const formData = new FormData(document.getElementById('assessmentForm'));

      // Checkboxes
      const dnacpr = document.getElementById('dnacpr').checked ? 'Yes' : 'No';
      const dols = document.getElementById('dols').checked ? 'Yes' : 'No';
      const covid19 = document.getElementById('covid19').checked ? 'Yes' : 'No';
      const poaHealth = document.getElementById('poaHealth').checked ? 'Yes' : 'No';
      const poaFinance = document.getElementById('poaFinance').checked ? 'Yes' : 'No';
      const diabetesFoot = document.getElementById('diabetesFoot').checked ? 'Yes' : 'No';
      const orthopedicFootwear = document.getElementById('orthopedicFootwear').checked ? 'Yes' : 'No';

      return {
        title: formData.get('title') || '',
        firstName: formData.get('firstName') || '',
        lastName: formData.get('lastName') || '',
        preferredName: formData.get('preferredName') || '',
        sexAtBirth: formData.get('sexAtBirth') || '',
        genderIdentity: formData.get('genderIdentity') || '',
        dob: formData.get('dob') || '',
        age: formData.get('age') || '',
        residentPhone: formData.get('residentPhone') || '',
        residentEmail: formData.get('residentEmail') || '',
        quickNotes: formData.get('quickNotes') || '',
        nhsNumber: formData.get('nhsNumber') || '',
        integrationId: formData.get('integrationId') || '',
        dnacpr,
        dols,
        covid19,

        nokFullName: formData.get('nokFullName') || '',
        nokRelationship: formData.get('nokRelationship') || '',
        nokPhone: formData.get('nokPhone') || '',
        poaHealth,
        poaFinance,

        dateAdmission: formData.get('dateAdmission') || '',
        admittedFrom: formData.get('admittedFrom') || '',
        fundingSource: formData.get('fundingSource') || '',

        allergies: formData.get('allergies') || '',
        dietaryPreferences: formData.get('dietaryPreferences') || '',
        emergencyInfo: formData.get('emergencyInfo') || '',
        clinicalHistory: formData.get('clinicalHistory') || '',
        medicationList: formData.get('medicationList') || '',
        currentWeight: formData.get('currentWeight') || '',
        currentHeight: formData.get('currentHeight') || '',
        bmiScore: formData.get('bmiScore') || '',
        weightLoss: formData.get('weightLoss') || '',
        mustScore: formData.get('mustScore') || '',

        advancedPlanning: formData.get('advancedPlanning') || '',
        cognition: formData.get('cognition') || '',
        communication: formData.get('communication') || '',
        continenceCare: formData.get('continenceCare') || '',
        emotionalWellbeing: formData.get('emotionalWellbeing') || '',
        sexuality: formData.get('sexuality') || '',
        lifeEnrichment: formData.get('lifeEnrichment') || '',
        medicationManagement: formData.get('medicationManagement') || '',
        mobilityDexterity: formData.get('mobilityDexterity') || '',
        nutritionHydration: formData.get('nutritionHydration') || '',
        oralHealth: formData.get('oralHealth') || '',
        personalCare: formData.get('personalCare') || '',
        physicalHealth: formData.get('physicalHealth') || '',
        skinIntegrity: formData.get('skinIntegrity') || '',
        sleepingNightCare: formData.get('sleepingNightCare') || '',

        // Step 6 new fields
        antiCoagulant: formData.get('antiCoagulant') || '',
        breathing: formData.get('breathing') || '',
        cancerCare: formData.get('cancerCare') || '',
        chokingRisk: formData.get('chokingRisk') || '',
        diabetesCare: formData.get('diabetesCare') || '',
        epilepsy: formData.get('epilepsy') || '',
        heartDisease: formData.get('heartDisease') || '',
        challengingBehaviours: formData.get('challengingBehaviours') || '',
        moneyManagement: formData.get('moneyManagement') || '',
        painManagement: formData.get('painManagement') || '',
        parkinsons: formData.get('parkinsons') || '',
        smokingAlcohol: formData.get('smokingAlcohol') || '',

        existingFootConditions: formData.get('existingFootConditions') || '',
        toenailCutting: formData.get('toenailCutting') || '',
        diabetesFoot,
        orthopedicFootwear,
        podiatryVisits: formData.get('podiatryVisits') || '',

        completedBy: formData.get('completedBy') || '',
        dateCompletion: formData.get('dateCompletion') || '',
        homeManagerApproval: formData.get('homeManagerApproval') || ''
      };
    }

    function createSummaryText(d) {
      return `
*** General Information ***
Title: ${d.title}
First Name: ${d.firstName}
Last Name: ${d.lastName}
Preferred Name: ${d.preferredName}
Sex at Birth: ${d.sexAtBirth}
Gender Identity: ${d.genderIdentity}
DOB: ${d.dob}
Age: ${d.age}
Resident Phone: ${d.residentPhone}
Resident Email: ${d.residentEmail}
Quick Notes: ${d.quickNotes}
NHS/CHI Number: ${d.nhsNumber}
Integration ID: ${d.integrationId}
DNACPR: ${d.dnacpr}
DoLS: ${d.dols}
Treating as COVID-19: ${d.covid19}

*** Circle of Care ***
Next of Kin: ${d.nokFullName}
Relationship: ${d.nokRelationship}
Phone: ${d.nokPhone}
POA for Health: ${d.poaHealth}
POA for Finance: ${d.poaFinance}

*** Onboarding & Needs Assessment ***
Date of Admission: ${d.dateAdmission}
Admitted From: ${d.admittedFrom}
Funding Source: ${d.fundingSource}

*** Clinical Information ***
Allergies & Intolerances: ${d.allergies}
Dietary Preferences & Nutrition Needs: ${d.dietaryPreferences}
Emergency Info & Admission Decision: ${d.emergencyInfo}
Clinical History & Medical Conditions: ${d.clinicalHistory}
Medication List: ${d.medicationList}
MUST:
  Weight (kg): ${d.currentWeight}
  Height (m): ${d.currentHeight}
  BMI Score: ${d.bmiScore}
  Weight Loss in Past 3-6 Months (%): ${d.weightLoss}
  Overall MUST Score: ${d.mustScore}

*** Mandatory Care Plan Sections ***
Advanced Planning (EOL): ${d.advancedPlanning}
Cognition: ${d.cognition}
Communication: ${d.communication}
Continence Care: ${d.continenceCare}
Emotional Well-being & Mental Health: ${d.emotionalWellbeing}
Expressing Sexuality: ${d.sexuality}
Life Enrichment & Social Activities: ${d.lifeEnrichment}
Medication Management: ${d.medicationManagement}
Mobility & Dexterity: ${d.mobilityDexterity}
Nutrition & Hydration: ${d.nutritionHydration}
Oral Health Care: ${d.oralHealth}
Personal Care & Hygiene: ${d.personalCare}
Physical Health & Well-being: ${d.physicalHealth}
Skin Integrity & Pressure Care: ${d.skinIntegrity}
Sleeping & Night Care: ${d.sleepingNightCare}

*** Specialist Care Plans (If Applicable) ***
Anti-Coagulant Management: ${d.antiCoagulant}
Breathing (COPD/Asthma): ${d.breathing}
Cancer Care: ${d.cancerCare}
Choking Risk & SALT: ${d.chokingRisk}
Diabetes Care & Foot Health: ${d.diabetesCare}
Epilepsy Management: ${d.epilepsy}
Heart Disease & Stroke Recovery: ${d.heartDisease}
Managing Behaviours that Challenge: ${d.challengingBehaviours}
Money Management Support: ${d.moneyManagement}
Pain Management Plan: ${d.painManagement}
Parkinson’s Care: ${d.parkinsons}
Smoking/Alcohol/Drug Use: ${d.smokingAlcohol}

*** Foot Care Assessment ***
Existing Foot Conditions: ${d.existingFootConditions}
Toenail Cutting Needs: ${d.toenailCutting}
Diabetes Foot Concerns: ${d.diabetesFoot}
Orthopedic Footwear: ${d.orthopedicFootwear}
Podiatry Visits: ${d.podiatryVisits}

*** Staff Sign-Off ***
Assessment Completed By: ${d.completedBy}
Date of Completion: ${d.dateCompletion}
Home Manager Approval: ${d.homeManagerApproval}
`;
    }

    if(generateSummaryBtn) {
      generateSummaryBtn.addEventListener('click', () => {
        const data = getFormData();
        const summaryArea = document.getElementById('summary');
        summaryArea.value = createSummaryText(data);
      });
    }

    if(downloadPdfBtn) {
      downloadPdfBtn.addEventListener('click', () => {
        const data = getFormData();
        const lines = createSummaryText(data).split('\n');

        const doc = new jsPDF({ unit: 'pt', format: 'a4' });
        const pageHeight = doc.internal.pageSize.getHeight();

        function drawHeader() {
          const pageWidth = doc.internal.pageSize.getWidth();
          doc.setFillColor(92,158,173);
          doc.rect(0, 0, pageWidth, 40, 'F');
          doc.setFont('Helvetica', 'bold');
          doc.setFontSize(18);
          doc.setTextColor(255,255,255);
          doc.text('Resident Assessment Form', 20, 26);
          doc.setFont('Helvetica', 'normal');
          doc.setFontSize(12);
          doc.setTextColor(0,0,0);
        }

        drawHeader();
        let x = 20;
        let y = 60;
        const lineHeight = 14;

        lines.forEach(line => {
          if(y > pageHeight - 40) {
            doc.addPage();
            drawHeader();
            y = 60;
          }
          if(line.startsWith('*** ')) {
            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(13);
            doc.text(line.replace('*** ','') , x, y);
            doc.setFont('Helvetica', 'normal');
            doc.setFontSize(12);
          } else {
            const splitted = doc.splitTextToSize(line, 550);
            splitted.forEach(str => {
              doc.text(str, x, y);
              y += lineHeight;
              if(y > pageHeight - 40) {
                doc.addPage();
                drawHeader();
                y = 60;
              }
            });
            y -= lineHeight;
          }
          y += lineHeight;
        });

        doc.save('Resident_Assessment.pdf');
      });
    }
  </script>
</body>
</html>
